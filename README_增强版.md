# MQTT摄像头监控系统 - 增强版

## 🎯 问题解决

原系统存在的问题：
- ❌ 只显示一个黑色视窗
- ❌ 无法单独配置每个摄像头参数
- ❌ 缺少实时日志显示
- ❌ 调试困难

## ✅ 增强功能

### 1. 6个独立摄像头视窗
- 同时显示6个USB摄像头的实时画面
- 3×2网格布局，清晰标识每个摄像头
- 实时显示摄像头参数和检测状态

### 2. 独立参数配置
- **每个摄像头可单独配置**：亮度、曝光、对比度、饱和度
- **实时调整**：通过控制面板即时调整，无需重启
- **配置保存**：支持配置文件中预设每个摄像头的参数

### 3. 实时日志监控
- **右侧控制面板**：显示系统运行状态
- **分类日志**：错误、警告、信息等不同级别
- **实时更新**：画面初始值、触发信息、检测变化
- **日志导出**：支持导出日志到文件

### 4. 增强调试功能
- **诊断工具**：自动检测摄像头和系统状态
- **测试模式**：无需真实摄像头即可测试界面
- **详细状态显示**：每个摄像头的基线值和当前值

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动系统（推荐）
```bash
python 启动增强监控.py
```

### 3. 测试模式（无需摄像头）
```bash
python test_enhanced_monitor.py
```

### 4. 问题诊断
```bash
python 诊断修复.py
```

## 📁 文件说明

### 核心文件
- `启动增强监控.py` - 增强版启动脚本
- `test_enhanced_monitor.py` - 测试模式脚本
- `诊断修复.py` - 问题诊断工具

### 配置文件
- `config.yaml` - 系统配置文件
- `调试配置示例.yaml` - 配置模板和说明

### 文档
- `使用文档.md` - 完整使用手册
- `快速调试指南.md` - 快速问题解决
- `README_增强版.md` - 本文件

### 增强组件
- `mqtt_camera_monitoring/visual_monitor.py` - 增强视觉监控组件
- `mqtt_camera_monitoring/config.py` - 增强配置管理

## 🎛️ 控制面板功能

### 摄像头控制标签
每个摄像头都有独立的控制区域：
- **启用/禁用**：开关摄像头
- **亮度滑块**：0-100调节
- **曝光滑块**：10-500毫秒调节
- **对比度滑块**：0-100调节
- **饱和度滑块**：0-100调节
- **自动曝光**：开关自动曝光模式
- **状态显示**：基线计数、当前计数、基线面积、当前面积

### 系统日志标签
- **实时日志显示**：滚动显示最新日志
- **颜色分类**：错误(红色)、警告(橙色)、信息(蓝色)
- **清空日志**：清除当前显示的日志
- **导出日志**：保存日志到文件
- **自动滚动**：自动滚动到最新日志

### 系统状态标签
- **MQTT连接状态**：显示连接状态
- **活跃摄像头数量**：显示可用摄像头数量
- **检测状态**：显示当前检测状态
- **触发次数**：显示总触发次数

## ⚙️ 配置说明

### 每个摄像头独立配置
```yaml
cameras:
  # 默认设置
  default_settings:
    brightness: 60
    exposure: 120
    contrast: 50
    saturation: 50
    auto_exposure: false
  
  # 每个摄像头的独立配置
  individual_settings:
    camera_0:
      brightness: 65
      exposure: 130
    camera_1:
      brightness: 55
      exposure: 110
    # ... 其他摄像头配置
```

### 检测参数配置
```yaml
red_light_detection:
  baseline_duration: 0.3      # 基线建立时间（秒）
  area_change_threshold: 0.1  # 面积变化阈值（10%）
  sensitivity: 0.8            # 检测灵敏度
```

## 🔧 故障排除

### 问题1：只显示一个黑色视窗
**解决方案**：
1. 运行 `python 诊断修复.py` 检测问题
2. 使用 `python 启动增强监控.py` 启动增强版
3. 检查摄像头连接和驱动

### 问题2：摄像头无法初始化
**解决方案**：
1. 检查USB连接和端口
2. 确认摄像头驱动已安装
3. 使用测试模式验证系统功能

### 问题3：参数调整无效
**解决方案**：
1. 确认摄像头支持参数调整
2. 检查配置文件格式
3. 重启系统应用新配置

## 📊 系统要求

### 硬件要求
- 6个USB摄像头
- USB 2.0/3.0端口或集线器
- 足够的系统内存（建议4GB+）

### 软件要求
- Python 3.8+
- OpenCV 4.0+
- tkinter（GUI支持）
- 其他依赖见requirements.txt

## 🎯 使用场景

### 1. 调试模式
- 使用控制面板实时调整参数
- 观察日志了解系统状态
- 测试不同配置的效果

### 2. 生产模式
- 预配置每个摄像头的最佳参数
- 监控系统运行状态
- 记录触发事件和检测变化

### 3. 测试模式
- 无需真实摄像头验证功能
- 模拟各种检测场景
- 验证界面和逻辑正确性

## 📈 性能优化

### 1. 摄像头配置优化
- 根据环境光照调整亮度和曝光
- 使用合适的分辨率和帧率
- 启用硬件加速（如果支持）

### 2. 系统资源优化
- 监控CPU和内存使用率
- 定期清理日志文件
- 优化检测算法参数

### 3. 网络优化
- 确保MQTT服务器稳定连接
- 优化消息传输频率
- 使用合适的QoS级别

## 🔄 版本历史

### v2.0 (增强版)
- ✅ 6个独立摄像头视窗
- ✅ 每个摄像头独立参数配置
- ✅ 实时日志监控系统
- ✅ 增强调试和诊断功能
- ✅ 图形化控制面板

### v1.0 (原版)
- ✅ 基础MQTT监控功能
- ✅ 红光检测算法
- ✅ 触发消息发送

## 📞 技术支持

如遇到问题，请：
1. 查看相关文档和配置示例
2. 运行诊断工具获取详细信息
3. 检查日志文件中的错误信息
4. 使用测试模式验证系统功能

系统设计为7×24小时稳定运行，支持自动重连和错误恢复。